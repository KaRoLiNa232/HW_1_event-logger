<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Sentiment Logger</title>
    <style>
        body { font-family: -apple-system, sans-serif; max-width: 500px; margin: 40px auto; padding: 20px; line-height: 1.5; color: #333; }
        .section { border: 1px solid #e0e0e0; padding: 20px; border-radius: 12px; margin-bottom: 20px; background: #f9f9f9; }
        h3 { margin-top: 0; color: #555; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #4285f4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #357ae8; }
        #status { text-align: center; font-weight: bold; margin-top: 10px; min-height: 24px; }
        .review-box { font-style: italic; background: #fff; padding: 10px; border-left: 4px solid #4285f4; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="section">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <input type="text" id="gasUrl" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à /exec URL">
        <button onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

    <div class="section">
        <h3>Review Sentiment Analyzer</h3>
        <div id="reviewDisplay" class="review-box">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤</div>
        <button onclick="sendData()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Sheets</button>
        <div id="status"></div>
    </div>

    <script>
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ—Å—Ç–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL
        const gasInput = document.getElementById('gasUrl');
        gasInput.value = localStorage.getItem('gasUrl') || '';

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–ª–∏ –¥–æ—Å—Ç–∞–µ–º —Å—Ç–∞–±–∏–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        function saveSettings() {
            localStorage.setItem('gasUrl', gasInput.value);
            updateStatus('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function updateStatus(text) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerText = text;
            setTimeout(() => statusDiv.innerText = '', 3000);
        }

        const reviews = [
            "–û—Ç–ª–∏—á–Ω—ã–π —Ç–æ–≤–∞—Ä, –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞!",
            "–£–∂–∞—Å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∏–∫–æ–º—É.",
            "–ù–æ—Ä–º–∞–ª—å–Ω–æ –∑–∞ —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏, –Ω–æ —É–ø–∞–∫–æ–≤–∫–∞ –ø–æ–º—è—Ç–∞.",
            "–í—Å—ë —Å—É–ø–µ—Ä, –±—É–¥—É –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å –µ—â–µ!",
            "–°–ª–æ–º–∞–ª–æ—Å—å —á–µ—Ä–µ–∑ –¥–≤–∞ –¥–Ω—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."
        ];

        async function sendData() {
            const url = gasInput.value;
            if (!url) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—Å—Ç–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞!');
                return;
            }

            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–∑—ã–≤
            const randomReview = reviews[Math.floor(Math.random() * reviews.length)];
            const sentiment = Math.random() > 0.5 ? "POSITIVE (99%)" : "NEGATIVE (82%)";
            
            // –°–æ–±–∏—Ä–∞–µ–º –ú–ï–¢–ê –¥–∞–Ω–Ω—ã–µ (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ)
            const meta = JSON.stringify({
                userId: userId,
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language
            });

            document.getElementById('reviewDisplay').innerText = `"${randomReview}" \n‚Äî ${sentiment}`;

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è "Simple Request" (x-www-form-urlencoded)
            const formData = new URLSearchParams();
            formData.append('review', randomReview);
            formData.append('sentiment', sentiment);
            formData.append('meta', meta);

            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors', // –í–∞–∂–Ω–æ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS preflight
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                });

                updateStatus('üöÄ –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –¢–∞–±–ª–∏—Ü—É!');
            } catch (error) {
                console.error(error);
                updateStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
            }
        }
    </script>
</body>
</html>
